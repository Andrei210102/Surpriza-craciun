<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <title>Etapa 3 – Integramă</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    :root {
      --bg: #020617;
      --card-bg: #020617;
      --border: #1f2937;
      --accent: #22c55e;
      --accent-strong: #16a34a;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --danger: #f97373;
      --highlight: #facc15; /* galben-auriu pentru AUGUST */
      --transition: 0.25s ease;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      background: radial-gradient(circle at top, #020617, #000);
      color: var(--text-main);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 16px;
    }

    .wrap {
      width: 100%;
      max-width: 720px;
      background: var(--card-bg);
      border-radius: 24px;
      border: 1px solid var(--border);
      padding: 22px 20px 24px;
      box-shadow: 0 24px 60px rgba(0, 0, 0, 0.7);
    }

    .title {
      font-size: 1.3rem;
      margin-bottom: 4px;
      text-align: center;
    }

    .subtitle {
      font-size: 0.88rem;
      color: var(--text-muted);
      margin-bottom: 16px;
      text-align: center;
    }

    .grid-box {
      padding: 12px 12px 10px;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: #020617;
      margin-bottom: 16px;
      overflow-x: auto;
    }

    .row {
      display: flex;
      margin-bottom: 4px;
    }

    .cell {
      width: 28px;
      height: 28px;
      border-radius: 3px;
      border: 1px solid #4b5563;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      transition: background var(--transition), border-color var(--transition);
    }

    .cell.blocked {
      background: #020617;
      border-color: #030712;
    }

    .cell input {
      width: 100%;
      height: 100%;
      border: none;
      outline: none;
      background: transparent;
      color: var(--text-main);
      font-size: 0.9rem;
      text-align: center;
      text-transform: uppercase;
    }

    .cell .hint-number {
      position: absolute;
      top: 1px;
      left: 2px;
      font-size: 0.55rem;
      color: var(--text-muted);
    }

    .row.correct .cell.letter {
      border-color: var(--accent);
      background: rgba(34, 197, 94, 0.08);
    }

    .highlight {
      border-color: var(--highlight) !important;
      background: rgba(250, 204, 21, 0.15) !important;
      box-shadow: 0 0 10px rgba(250, 204, 21, 0.4);
      animation: pulse 1.2s infinite alternate;
    }

    @keyframes pulse {
      from { box-shadow: 0 0 8px rgba(250, 204, 21, 0.4); }
      to { box-shadow: 0 0 18px rgba(250, 204, 21, 0.9); }
    }

    .legend-box {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--border);
      background: #020617;
      font-size: 0.85rem;
      color: var(--text-muted);
      margin-top: 10px;
    }

    .legend-title {
      font-weight: 600;
      margin-bottom: 6px;
      color: var(--text-main);
    }

    .legend-list {
      padding-left: 18px;
    }

    .btn-main {
      margin-top: 14px;
      width: 100%;
      border-radius: 999px;
      padding: 9px 12px;
      border: none;
      background: var(--accent);
      color: #020617;
      font-size: 0.95rem;
      font-weight: 500;
      cursor: pointer;
      transition: background var(--transition), transform var(--transition);
    }

    .btn-main:hover {
      background: var(--accent-strong);
      transform: translateY(-1px);
    }

    .status {
      margin-top: 8px;
      font-size: 0.86rem;
      min-height: 18px;
      text-align: center;
    }

    .status.error {
      color: var(--danger);
    }

    .solution-box {
      display: none;
      margin-top: 16px;
      text-align: center;
    }

    .final-btn {
      margin-top: 10px;
      width: 100%;
      border-radius: 999px;
      padding: 8px 12px;
      border: 1px solid var(--accent);
      background: transparent;
      color: var(--accent);
      font-size: 0.9rem;
      cursor: pointer;
      transition: background var(--transition), color var(--transition);
    }

    .final-btn:hover {
      background: var(--accent);
      color: #020617;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">Etapa 3 – Integramă</h1>
    <p class="subtitle">
      Completează căsuțele ca într-o integrămă clasică. Fiecare număr are o definiție în legendă.
    </p>

    <div class="grid-box" id="gridBox"></div>

    <button class="btn-main" id="checkBtn">Verifică integrama</button>
    <div class="status" id="status"></div>

    <div class="solution-box" id="solutionBox">
      <button class="final-btn" id="finalBtn">Mergi la etapa finală</button>
    </div>

    <div class="legend-box">
      <div class="legend-title">Cine are definițiile</div>
      <ul class="legend-list">
        <li>Amira</li>
        <li>Bianca</li>
        <li>Ionuț</li>
        <li>Liviu</li>
        <li>Lidia</li>
        <li>Andrei</li>
      </ul>
      <div style="font-size:0.8rem;margin-top:4px;">
        Fiecare nume corespunde unui cuvânt numerotat în grilă (1–6).  
      </div>
    </div>
  </div>

  <script>
    const COLS = 12;
    const FINAL_URL = "etapa4.html";

    const WORDS = [
      { number: 1, answer: "BANEASA",  startCol: 2 },
      { number: 2, answer: "IEPURAS",  startCol: 3 },
      { number: 3, answer: "RUGINA",   startCol: 4 },
      { number: 4, answer: "TRIBUNAL", startCol: 2 },
      { number: 5, answer: "BISERICA", startCol: 4 },
      { number: 6, answer: "GOLESTI",  startCol: 1 }
    ];

    const gridBox = document.getElementById("gridBox");
    const checkBtn = document.getElementById("checkBtn");
    const statusEl = document.getElementById("status");
    const solutionBox = document.getElementById("solutionBox");
    const finalBtn = document.getElementById("finalBtn");

    const rowsState = [];
    const highlightCells = [];

    function createRow(wordConfig, rowIndex) {
      const rowEl = document.createElement("div");
      rowEl.className = "row";

      const inputs = [];

      for (let col = 0; col < COLS; col++) {
        const cell = document.createElement("div");
        cell.className = "cell blocked";

        const withinWord =
          col >= wordConfig.startCol &&
          col < wordConfig.startCol + wordConfig.answer.length;

        if (withinWord) {
          cell.className = "cell letter";
          const input = document.createElement("input");
          input.type = "text";
          input.maxLength = 1;
          input.autocomplete = "off";

          // mișcare automată între litere
          input.addEventListener("input", () => {
            input.value = input.value.toUpperCase().slice(0, 1);
            if (input.value) {
              const idx = inputs.findIndex(e => e === input);
              if (idx > -1 && idx < inputs.length - 1) inputs[idx + 1].focus();
            }
          });

          input.addEventListener("keydown", (e) => {
            if (e.key === "Backspace" && !input.value) {
              const idx = inputs.findIndex(e => e === input);
              if (idx > 0) inputs[idx - 1].focus();
            }
          });

          if (col === wordConfig.startCol) {
            const hint = document.createElement("span");
            hint.className = "hint-number";
            hint.textContent = wordConfig.number;
            cell.appendChild(hint);
          }

          cell.appendChild(input);
          inputs.push(input);

          // salvează poziția verticală a cuvântului AUGUST
          if (
            (rowIndex === 0 && col === 6) ||
            (rowIndex === 1 && col === 6) ||
            (rowIndex === 2 && col === 6) ||
            (rowIndex === 3 && col === 6) ||
            (rowIndex === 4 && col === 6) ||
            (rowIndex === 5 && col === 6)
          ) {
            highlightCells.push(cell);
          }
        }

        rowEl.appendChild(cell);
      }

      gridBox.appendChild(rowEl);
      rowsState.push({ rowEl, inputs, word: wordConfig.answer });
    }

    function renderGrid() {
      WORDS.forEach((w, i) => createRow(w, i));
    }

    function normalize(str) {
      return str
        .trim()
        .toUpperCase()
        .normalize("NFD")
        .replace(/[\u0300-\u036f]/g, "");
    }

    function checkCrossword() {
      let allFilled = true;
      let allCorrect = true;

      rowsState.forEach(({ rowEl, inputs, word }) => {
        const userWord = inputs.map(i => i.value || " ").join("");
        const nUser = normalize(userWord);
        const nCorrect = normalize(word);

        rowEl.classList.remove("correct", "incorrect");

        if (nUser.length < nCorrect.length) {
          allFilled = false;
          allCorrect = false;
          rowEl.classList.add("incorrect");
          return;
        }

        if (nUser === nCorrect) {
          rowEl.classList.add("correct");
        } else {
          allCorrect = false;
          rowEl.classList.add("incorrect");
        }
      });

      statusEl.className = "status";

      if (!allFilled) {
        statusEl.textContent = "Nu toate cuvintele sunt completate.";
        statusEl.classList.add("error");
        solutionBox.style.display = "none";
        return;
      }

      if (!allCorrect) {
        statusEl.textContent = "Unele cuvinte sunt greșite.";
        statusEl.classList.add("error");
        solutionBox.style.display = "none";
        return;
      }

      // toate corecte → evidențiem AUGUST
      highlightCells.forEach(c => c.classList.add("highlight"));
      statusEl.textContent = "";
      solutionBox.style.display = "block";
    }

    checkBtn.addEventListener("click", checkCrossword);
    finalBtn.addEventListener("click", () => {
      window.location.href = FINAL_URL;
    });

    renderGrid();
  </script>
</body>
</html>
